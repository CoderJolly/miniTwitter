<% if logged_in? %>
  <div class="row">
    <aside class="col-md-4">
      <section class="user_info">
        <%= render 'shared/user_info' %>
      </section>
      <section class="stats">
        <%= render 'shared/stats' %>
      </section>
      <section class="micropost_form">
        <%= render 'shared/micropost_form' %>
      </section>
    </aside>

    <%= form_for :term, url: search_path, method: :get do |form| %>
      <p>
        <%= text_field_tag :term, params[:term] %>
        <%= submit_tag "Search", name: nil, class: "btn btn-primary" %>
      </p>
    <% end %>

    <div class="col-md-8">
      <h3>Micropost Feed</h3>
      <%= render 'shared/feed' %>
    </div>
  </div>

  <% if logged_in? %>
  <script src="https://js.pusher.com/4.0/pusher.min.js"></script>
    <script>
      // Enable pusher logging - don't include this in production
      Pusher.logToConsole = true;

      var pusher_client = new Pusher('ce88be7709ffe9b382ea', {
        encrypted: true
      });

      var channel = pusher_client.subscribe("miniTwitter-channel");
      channel.bind("miniTwitter-event-follow-" + "<%= @current_user.id %>", function(data) {
  			    alert(data.message);
      });

      channel.bind("miniTwitter-event-logout-" + "<%= @current_user.id %>", function(data) {
          sessionStorage.removeItem("pusher_client")
      });
    </script>
  <% end %>
<% else %>
  <div class="center jumbotron">
  	<h1>Welcome to the miniTwitter App</h1>
	   <h2>
    	  This is the home page for the
    	   <a href="http://www.railstutorial.org/">Ruby on Rails Tutorial</a>
         miniTwitter application.
  	  </h2>

  	  <%= link_to "Sign up now!", signup_path , class: "btn btn-lg btn-primary" %>
	  </div>
    <%= link_to image_tag("rails.png", alt: "Rails logo"), 'http://rubyonrails.org/' %>
<% end %>
